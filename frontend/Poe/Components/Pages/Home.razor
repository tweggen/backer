@page "/"
@layout Poe.Components.Layout.PublicLayout
@using Microsoft.AspNetCore.Components.Authorization
@inject NavigationManager Navigation
@inject Tools.AppBasePath BasePath
@inject AuthenticationStateProvider AuthenticationStateProvider

<PageTitle>Backer - Backup Manager</PageTitle>

<AuthorizeView>
    <Authorized>
        @* Will redirect in OnInitializedAsync *@
    </Authorized>
    <NotAuthorized Context="authContext">
        <div class="landing-container">
            <div class="landing-hero">
                <div class="hero-content">
                    <h1 class="hero-title">
                        <span class="hero-icon">‚òÅÔ∏è</span>
                        Backer
                    </h1>
                    <p class="hero-subtitle">
                        Automated backup management powered by rclone.<br/>
                        Protect your files with scheduled backups to cloud storage and network shares.
                    </p>
                    <div class="hero-features">
                        <div class="feature">
                            <span class="feature-icon">üìÅ</span>
                            <span>Multiple Storage Providers</span>
                        </div>
                        <div class="feature">
                            <span class="feature-icon">‚è∞</span>
                            <span>Scheduled Backups</span>
                        </div>
                        <div class="feature">
                            <span class="feature-icon">üîÑ</span>
                            <span>Sync & Copy Modes</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="auth-container">
                <h2 class="auth-title">Get Started</h2>
                <p class="auth-subtitle">Sign in to manage your backups or create a new account.</p>
                
                <div class="auth-buttons">
                    <a href="@($"{BasePath.Value}/login")" class="btn btn-primary btn-lg w-100 mb-3">
                        Sign In
                    </a>
                    <a href="@($"{BasePath.Value}/signup")" class="btn btn-outline-secondary btn-lg w-100">
                        Create Account
                    </a>
                </div>
                
                <div class="auth-features">
                    <div class="auth-feature">
                        <span>‚úì</span> OneDrive, Dropbox, Google Drive
                    </div>
                    <div class="auth-feature">
                        <span>‚úì</span> SMB/CIFS Network Shares
                    </div>
                    <div class="auth-feature">
                        <span>‚úì</span> Automated Scheduling
                    </div>
                </div>
                
                @* PWA Install Button - hidden by default, shown via JS when available *@
                <div class="install-prompt">
                    <button id="pwaInstallButton" class="btn btn-success w-100 d-none" onclick="installPwa()">
                        <span class="install-icon">üì±</span> Install App
                    </button>
                </div>
            </div>
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {
    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        if (authState.User.Identity?.IsAuthenticated == true)
        {
            Navigation.NavigateTo($"{BasePath.Value}/backer/", forceLoad: true);
        }
    }
}
